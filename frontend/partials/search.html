<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tìm kiếm - Bệnh viện Ánh Dương</title>
  <link rel="stylesheet" href="../css/style.css" />
</head>
<body>
  <div data-include="header.html"></div>

  <main class="container search-page">
    <section class="search-hero">
      <h1>Tìm kiếm</h1>
      <form id="searchForm" class="search-form" method="get">
        <input type="text" name="q" id="searchInput" placeholder="Nhập tên bác sĩ / chuyên khoa..." />
        <button type="submit">Tìm</button>
      </form>
      <p class="search-hint">Kết quả sẽ lọc từ danh sách bác sĩ (tên, chuyên khoa, tag).</p>
    </section>

    <section class="search-block">
      <div class="search-block-head">
        <h2 class="search-title">Kết quả bác sĩ</h2>
        <div id="searchDocCount" class="search-count"></div>
      </div>
      <div id="searchResults" class="search-results"></div>
    </section>

    <section class="search-block">
      <div class="search-block-head">
        <h2 class="search-title">Kết quả tin tức</h2>
        <div id="searchNewsCount" class="search-count"></div>
      </div>
      <div id="searchNews" class="search-results"></div>
    </section>

    <div id="searchEmpty" class="search-empty" hidden>Không tìm thấy kết quả phù hợp.</div>
    </section>
  </main>

  <div data-include="footer.html"></div>
  <div data-include="chat.html"></div>

  <script src="../js/app.js"></script>
  <script src="include.js"></script>
  <script>
    const newsData = [
      { title: 'Bộ Y tế xây dựng gói dịch vụ y tế cơ bản thuộc phạm vi miễn viện phí', desc: 'Chủ trương tiến tới miễn viện phí để bảo đảm quyền được chăm sóc sức khỏe.', link: 'tin-1.html' },
      { title: 'WHO khuyến nghị Việt Nam mạnh tay với thuốc lá điện tử', desc: 'Đề xuất chiến dịch quyết liệt để kiểm soát thuốc lá điện tử.', link: 'tin-2.html' },
      { title: 'Hiện thực hóa hành động kiểm soát sốt xuất huyết', desc: 'Hội nghị nhấn mạnh hành động toàn diện trong kiểm soát dịch.', link: 'tin-3.html' },
      { title: 'Siết chất lượng đào tạo ngành y, chuẩn hóa thực hành', desc: 'Chuẩn hóa đào tạo, siết điều kiện mở ngành y để nâng chất lượng.', link: 'tin-4.html' },
      { title: 'Diễn tập ứng phó bảo đảm an toàn bức xạ trong y tế', desc: 'Bệnh viện diễn tập kịch bản sự cố bức xạ, nâng năng lực ứng phó.', link: 'tin-5.html' },
      { title: 'Ngày Thế giới phòng, chống AIDS: cảnh báo trẻ hóa và lây nhiễm âm thầm', desc: 'Tăng truyền thông, nguồn lực, dịch vụ thân thiện để giảm lây nhiễm.', link: 'tin-6.html' },
      { title: '70% dịch bệnh bắt nguồn từ động vật: củng cố tuyến thú y công cộng', desc: 'Nhấn mạnh hoàn thiện pháp luật và năng lực tuyến thú y công cộng.', link: 'tin-7.html' },
    ];

    function renderDoctorResults(list) {
      const wrap = document.getElementById('searchResults');
      const count = document.getElementById('searchDocCount');
      if (!wrap || !count) return;
      wrap.innerHTML = '';
      count.textContent = list.length ? `${list.length} kết quả` : '0 kết quả';
      list.forEach(d => {
        const card = document.createElement('article');
        card.className = 'search-card';

        const avatar = document.createElement('div');
        avatar.className = 'search-avatar';
        if (d.photo) {
          const img = document.createElement('img');
          img.src = d.photo;
          img.alt = d.name;
          avatar.appendChild(img);
        } else {
          avatar.textContent = (d.name || '?').slice(0, 1);
        }

        const info = document.createElement('div');
        info.className = 'search-info';
        info.innerHTML = `
          <h3>${d.name}</h3>
          <div class="search-spec">${d.specialty}</div>
          <div class="search-meta">Kinh nghiệm: ${d.exp} năm • Đánh giá: ${d.rating?.toFixed(1) || '—'}</div>
        `;

        const actions = document.createElement('div');
        actions.className = 'search-actions';
        const link = document.createElement('a');
        link.href = `dat-lich-kham.html?spec=${encodeURIComponent(d.specialty)}&doctor=${encodeURIComponent(d.id)}`;
        link.className = 'search-btn';
        link.textContent = 'Đặt lịch';
        actions.appendChild(link);

        card.appendChild(avatar);
        card.appendChild(info);
        card.appendChild(actions);
        wrap.appendChild(card);
      });
    }

    function renderNewsResults(list) {
      const wrap = document.getElementById('searchNews');
      const count = document.getElementById('searchNewsCount');
      if (!wrap || !count) return;
      wrap.innerHTML = '';
      count.textContent = list.length ? `${list.length} kết quả` : '0 kết quả';
      list.forEach(n => {
        const card = document.createElement('article');
        card.className = 'search-card search-card-news';
        card.innerHTML = `
          <div class="search-info">
            <h3>${n.title}</h3>
            <p class="search-news-desc">${n.desc}</p>
          </div>
          <div class="search-actions">
            <a class="search-btn" href="${n.link}">Xem chi tiết</a>
          </div>
        `;
        wrap.appendChild(card);
      });
    }

    function doSearch(q) {
      const empty = document.getElementById('searchEmpty');
      if (!Array.isArray(doctors)) return;
      const keyword = (q || '').trim().toLowerCase();
      if (!keyword) {
        renderDoctorResults([]);
        renderNewsResults([]);
        if (empty) empty.hidden = false;
        return;
      }
      const results = doctors.filter(d => {
        const blob = [d.name, d.specialty, ...(d.tags || [])].join(' ').toLowerCase();
        return blob.includes(keyword);
      });
      const newsResults = newsData.filter(n => {
        const blob = (n.title + ' ' + (n.desc || '')).toLowerCase();
        return blob.includes(keyword);
      });
      renderDoctorResults(results);
      renderNewsResults(newsResults);
      if (empty) empty.hidden = results.length || newsResults.length;
    }

    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const q = params.get('q') || '';
      const input = document.getElementById('searchInput');
      if (input) input.value = q;
      doSearch(q);

      document.getElementById('searchForm')?.addEventListener('submit', (e) => {
        e.preventDefault();
        const keyword = input?.value || '';
        const url = new URL(window.location.href);
        url.searchParams.set('q', keyword);
        window.history.replaceState({}, '', url.toString());
        doSearch(keyword);
      });
    });
  </script>
</body>
</html>
